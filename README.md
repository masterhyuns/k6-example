# Next.js k6 Performance Test Example

Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•œ í¬ê´„ì ì¸ k6 ì„±ëŠ¥ ë¶€í•˜í…ŒìŠ¤íŠ¸ ì˜ˆì œì…ë‹ˆë‹¤.
DBë‚˜ Docker ì—†ì´ ë©”ëª¨ë¦¬ ëª©ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°”ë¡œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. ì˜ì¡´ì„± ì„¤ì¹˜
```bash
# Node.js íŒ¨í‚¤ì§€ ì„¤ì¹˜
npm install

# k6 ì„¤ì¹˜ (macOS)
brew install k6

# k6 ì„¤ì¹˜ (Windows)
choco install k6

# k6 ì„¤ì¹˜ (Linux)
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C5AD17C747E3415A3642D57D77C6C491D6AC1D69
echo "deb https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list
sudo apt-get update
sudo apt-get install k6
```

### 2. Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ (í¬íŠ¸ 4000)
```bash
# ê°œë°œ ì„œë²„ ì‹¤í–‰ (í¬íŠ¸ 4000)
npm run dev

# ë˜ëŠ” í”„ë¡œë•ì…˜ ëª¨ë“œ (í¬íŠ¸ 4000)
npm run build
npm run start
```

### 3. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
# Smoke Test (1ë¶„) - ê¸°ë³¸ ë™ì‘ í™•ì¸
npm run test:smoke

# Load Test (16ë¶„) - ì •ìƒ ë¶€í•˜ í…ŒìŠ¤íŠ¸
npm run test:load

# Stress Test (25ë¶„) - í•œê³„ì  ì°¾ê¸°
npm run test:stress

# Spike Test (10ë¶„) - ê¸‰ê²©í•œ íŠ¸ë˜í”½ ì¦ê°€
npm run test:spike

# Soak Test (2ì‹œê°„+) - ì¥ì‹œê°„ ì•ˆì •ì„±
npm run test:soak

# ëª¨ë“  í…ŒìŠ¤íŠ¸ ìˆœì°¨ ì‹¤í–‰
npm run test:all
```

## ğŸ“ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„¸

### Smoke Test
- **ëª©ì **: ìµœì†Œ ë¶€í•˜ì—ì„œ ì‹œìŠ¤í…œ ì •ìƒ ë™ì‘ í™•ì¸
- **VUs**: 1ëª…
- **Duration**: 1ë¶„
- **ì„±ê³µ ê¸°ì¤€**: ì—ëŸ¬ìœ¨ < 1%, P95 < 500ms

### Load Test
- **ëª©ì **: ì˜ˆìƒ íŠ¸ë˜í”½ì—ì„œ ì„±ëŠ¥ í™•ì¸
- **VUs**: 50-100ëª… ì ì§„ì  ì¦ê°€
- **Duration**: 16ë¶„
- **ì„±ê³µ ê¸°ì¤€**: ì—ëŸ¬ìœ¨ < 5%, P95 < 1000ms

### Stress Test
- **ëª©ì **: ì‹œìŠ¤í…œ í•œê³„ì  ì°¾ê¸°
- **VUs**: 100-600ëª… ì ì§„ì  ì¦ê°€
- **Duration**: 25ë¶„
- **ê´€ì°°**: Breaking point, ì„±ëŠ¥ ì €í•˜ ì‹œì 

### Spike Test
- **ëª©ì **: ê¸‰ê²©í•œ íŠ¸ë˜í”½ ì¦ê°€ ëŒ€ì‘ë ¥
- **VUs**: 10 â†’ 300 â†’ 10 â†’ 500 â†’ 10
- **Duration**: 10ë¶„
- **ê´€ì°°**: ë³µêµ¬ ì‹œê°„, ë°ì´í„° ë¬´ê²°ì„±

### Soak Test
- **ëª©ì **: ì¥ì‹œê°„ ìš´ì˜ ì•ˆì •ì„±
- **VUs**: 50ëª… ìœ ì§€
- **Duration**: 2ì‹œê°„+
- **ê´€ì°°**: ë©”ëª¨ë¦¬ ëˆ„ìˆ˜, ì„±ëŠ¥ ì €í•˜

## ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
k6-example/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ api/               # API Routes (ëª©ë°ì´í„° í¬í•¨)
â”‚   â”‚   â”œâ”€â”€ posts/        # ê²Œì‹œë¬¼ API
â”‚   â”‚   â”œâ”€â”€ users/        # ì‚¬ìš©ì API
â”‚   â”‚   â””â”€â”€ health/       # í—¬ìŠ¤ì²´í¬ API
â”‚   â””â”€â”€ page.tsx          # ë©”ì¸ í˜ì´ì§€
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ k6/               # k6 í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
â”‚       â”œâ”€â”€ smoke.js      # ê¸°ë³¸ ë™ì‘ í…ŒìŠ¤íŠ¸
â”‚       â”œâ”€â”€ load.js       # ë¶€í•˜ í…ŒìŠ¤íŠ¸
â”‚       â”œâ”€â”€ stress.js     # ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
â”‚       â”œâ”€â”€ spike.js      # ìŠ¤íŒŒì´í¬ í…ŒìŠ¤íŠ¸
â”‚       â””â”€â”€ soak.js       # ì¥ì‹œê°„ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ types.ts              # TypeScript íƒ€ì… ì •ì˜
â””â”€â”€ run-tests.sh         # í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
```

## ğŸ“ˆ ì„±ëŠ¥ ë©”íŠ¸ë¦­

### í•µì‹¬ ì§€í‘œ
- **Response Time**: P50, P95, P99
- **Throughput**: Requests/sec
- **Error Rate**: Failed requests %
- **Concurrency**: Virtual Users
- **Resource Usage**: Memory, CPU

### ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­
- `api_duration`: API ì‘ë‹µ ì‹œê°„
- `spike_errors`: ìŠ¤íŒŒì´í¬ ì¤‘ ì—ëŸ¬
- `memory_usage`: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
- `data_integrity`: ë°ì´í„° ë¬´ê²°ì„±
- `recovery_time`: ë³µêµ¬ ì‹œê°„

## ğŸ”§ í™˜ê²½ ë³€ìˆ˜

```bash
# í…ŒìŠ¤íŠ¸ ëŒ€ìƒ URL (ê¸°ë³¸ê°’: í¬íŠ¸ 4000)
export BASE_URL=http://localhost:4000
```

## ğŸ’¡ ì„±ëŠ¥ ìµœì í™” ê¶Œì¥ì‚¬í•­

### ì¦‰ì‹œ ì ìš© ê°€ëŠ¥
1. Response ìºì‹± í—¤ë” ì¶”ê°€
2. API ì‘ë‹µ ì••ì¶• (gzip)
3. ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ìµœì í™”

### ë‹¨ê¸° ê°œì„ 
1. Redis ìºì‹± ë ˆì´ì–´ êµ¬í˜„
2. CDN ì ìš© (ì •ì  ìì›)
3. API Rate Limiting

### ì¥ê¸° ì•„í‚¤í…ì²˜
1. ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë¶„ë¦¬
2. ì½ê¸° ì „ìš© ë³µì œë³¸
3. ì˜¤í† ìŠ¤ì¼€ì¼ë§ êµ¬ì„±

## ğŸ“š ì°¸ê³  ë¬¸ì„œ
- [k6 Documentation](https://k6.io/docs/)
- [Next.js Performance](https://nextjs.org/docs/advanced-features/measuring-performance)
- [Grafana k6 Dashboard](https://grafana.com/grafana/dashboards/2587)

## ğŸ¯ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ê°œë°œ í™˜ê²½ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ìŠ¤í…Œì´ì§• í™˜ê²½ í…ŒìŠ¤íŠ¸
- [ ] í”„ë¡œë•ì…˜ ìœ ì‚¬ í™˜ê²½ í…ŒìŠ¤íŠ¸
- [ ] ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ êµ¬ì„±
- [ ] ì„±ëŠ¥ ê¸°ì¤€ì„ (baseline) ì„¤ì •
- [ ] CI/CD íŒŒì´í”„ë¼ì¸ í†µí•©


ğŸ¯ SMOKE TEST ê²°ê³¼ ë¶„ì„

âœ“ Checks: 112/112

- ì˜ë¯¸: í…ŒìŠ¤íŠ¸ ì¤‘ ìˆ˜í–‰í•œ ëª¨ë“  ê²€ì¦ì´ ì„±ê³µí–ˆìŠµë‹ˆë‹¤
- ì„¤ëª…: 112ê°œì˜ ì²´í¬ í¬ì¸íŠ¸(ì‘ë‹µ ìƒíƒœ, ì‘ë‹µ ì‹œê°„, ë°ì´í„° êµ¬ì¡° ë“±) ëª¨ë‘ í†µê³¼
- íŒë‹¨: âœ… ì™„ë²½ - ì‹œìŠ¤í…œì´ ê¸°ëŒ€í•œ ëŒ€ë¡œ ë™ì‘

âœ“ Error Rate: 0.00%

- ì˜ë¯¸: ì—ëŸ¬ê°€ ì „í˜€ ë°œìƒí•˜ì§€ ì•ŠìŒ
- ì„¤ëª…: ëª¨ë“  HTTP ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë¨
- íŒë‹¨: âœ… ë§¤ìš° ì¢‹ìŒ - ì•ˆì •ì ì¸ ì‹œìŠ¤í…œ

âœ“ HTTP Request Duration

- avg=32.40ms: í‰ê·  ì‘ë‹µ ì‹œê°„ì´ 32ë°€ë¦¬ì´ˆ
    - ì‚¬ìš©ì ì²´ê°: ì¦‰ê°ì ì¸ ë°˜ì‘
- p(95)=78.76ms: 95%ì˜ ìš”ì²­ì´ 79ë°€ë¦¬ì´ˆ ì´ë‚´ ì™„ë£Œ
    - ëŒ€ë¶€ë¶„ì˜ ì‚¬ìš©ìê°€ ë¹ ë¥¸ ì‘ë‹µ ê²½í—˜
- íŒë‹¨: âœ… ìš°ìˆ˜ - ì¼ë°˜ì ìœ¼ë¡œ 200ms ì´í•˜ë©´ ì¢‹ì€ ì„±ëŠ¥

âœ“ HTTP Request Failed: 0.00%

- ì˜ë¯¸: ì‹¤íŒ¨í•œ HTTP ìš”ì²­ì´ ì—†ìŒ
- ì„¤ëª…: 4xx, 5xx ì—ëŸ¬ë‚˜ íƒ€ì„ì•„ì›ƒì´ ë°œìƒí•˜ì§€ ì•ŠìŒ
- íŒë‹¨: âœ… ì™„ë²½ - 100% ê°€ìš©ì„±

âœ“ Virtual Users: 1

- ì˜ë¯¸: 1ëª…ì˜ ê°€ìƒ ì‚¬ìš©ìë¡œ í…ŒìŠ¤íŠ¸
- ì„¤ëª…: Smoke TestëŠ” ìµœì†Œ ë¶€í•˜ë¡œ ê¸°ë³¸ ë™ì‘ë§Œ í™•ì¸
- ëª©ì : ì‹œìŠ¤í…œì˜ ê¸°ë³¸ ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ ê²€ì¦

âœ“ Test Duration: 1m

- ì˜ë¯¸: í…ŒìŠ¤íŠ¸ë¥¼ 1ë¶„ê°„ ì‹¤í–‰
- ì„¤ëª…: ì§§ì€ ì‹œê°„ ë™ì•ˆ í•µì‹¬ ì‹œë‚˜ë¦¬ì˜¤ ë°˜ë³µ í…ŒìŠ¤íŠ¸

ğŸ“Š ì¢…í•© í‰ê°€

ğŸ† í…ŒìŠ¤íŠ¸ ê²°ê³¼: EXCELLENT (ì™„ë²½)

ì„±ëŠ¥ ë“±ê¸‰: A+
- ì‘ë‹µ ì†ë„: â­â­â­â­â­ (32ms í‰ê· )
- ì•ˆì •ì„±: â­â­â­â­â­ (0% ì—ëŸ¬)
- ì¼ê´€ì„±: â­â­â­â­â­ (P95ê°€ í‰ê· ì˜ 2.4ë°°ë¡œ ì•ˆì •ì )

ê²°ë¡ : ì‹œìŠ¤í…œì´ ê¸°ë³¸ ë¶€í•˜ì—ì„œ ì™„ë²½í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤.
ë‹¤ìŒ ë‹¨ê³„: Load Testë¡œ ë” ë†’ì€ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê¶Œì¥

ğŸ’¡ ì°¸ê³  ê¸°ì¤€

| ì‘ë‹µì‹œê°„       | ì‚¬ìš©ì ì²´ê° |
  |------------|--------|
| < 100ms    | ì¦‰ê°ì     |
| 100-300ms  | ë¹ ë¦„     |
| 300-1000ms | ë³´í†µ     |
| > 1000ms   | ëŠë¦¼     |

í˜„ì¬ 32msëŠ” "ì¦‰ê°ì " ìˆ˜ì¤€ìœ¼ë¡œ ë§¤ìš° ìš°ìˆ˜í•œ ì„±ëŠ¥ì…ë‹ˆë‹¤!